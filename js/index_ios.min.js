var click_item,claim_dialog,province_list,grade_list,app_info,current_page;function countDown(lefttime,callback){--lefttime>0&&setTimeout(()=>{countDown(lefttime,callback)},1e3),callback(lefttime)}function getUrl(host,path){switch(host){case"my":return"https://szone-my.7net.cc"+path;case"old":return"https://szone-api.7net.cc"+path;case"score":return"https://szone-score.7net.cc"+path}}function getUserInfo(callback){$.ajax({method:"get",url:getUrl("my","/userInfo/GetUserInfo"),headers:{Version:localStorage.getItem("szoneVersion"),Token:localStorage.getItem("Token")},dataType:"json",success:(data,status)=>callback(data,status)})}function resetPage(){$(".loaded").removeClass("loaded"),$(".exam-item-pgs").removeClass("exam-end").removeClass("mdui-hidden"),$("#examList").empty(),$("#unClaimExamList").empty(),$(".noUnclaimExam").text("").addClass("mdui-hidden"),$("#login-btn").val("登录")}function logout(){mdui.snackbar({message:"退出登录",buttonText:"确定",onButtonClick:()=>{localStorage.removeItem("Token"),localStorage.removeItem("userInfo"),showPage("login",!1,null),resetPage()}})}function getUserCache(){return null!==localStorage.getItem("userInfo")&&JSON.parse(Base64.decode(localStorage.getItem("userInfo")))}function getQueryString(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)"),r=window.location.search.substr(1).match(reg);return null!==r?decodeURI(r[2]):null}function setBG(){let i=-1,page_name;switch(current_page){case"index":i=0;break;case"user":i=1;break;default:return}let bg=document.querySelectorAll(".background-card")[i].getBoundingClientRect(),it=document.querySelectorAll(".userBasicInfo")[i].getBoundingClientRect();$(".background-card").eq(i).css("background-position",`0px ${0-(1155*bg.width/2048+it.height-bg.height)}px`)}function showPage(page_name,add_history,state){add_history?history.pushState(state,$("."+page_name).attr("title"),page_name+".html"):history.replaceState(state,$("."+page_name).attr("title"),page_name+".html");let page=$(".main-container."+page_name);if(0===page.length)return location.assign("404.html"),!1;let index_drawer=new mdui.Drawer("#drawer");switch("closed"!==index_drawer.getState()&&"closing"!==index_drawer.getState()&&"index"!==page_name&&($(".index").attr("drawer","open"),$(".mdui-overlay").remove(),index_drawer.close()),$(".app-show").removeClass("app-show"),page.addClass("app-show"),document.title=page.attr("title"),$(".page-loading").addClass("mdui-hidden"),"true"===page.attr("back-up-btn")?$(".back-up-btn-box").removeClass("mdui-hidden"):$(".back-up-btn-box").addClass("mdui-hidden"),page.attr("appbar")){case"simple-appbar":$(".simple-appbar").removeClass("mdui-hidden"),$(".simple-appbar .mdui-typo-title").text(page.attr("title")),"true"===page.attr("back-btn")?$(".simple-appbar a").removeClass("mdui-hidden"):$(".simple-appbar a").addClass("mdui-hidden");break;case"none":$(".simple-appbar").addClass("mdui-hidden")}page.hasClass("loaded")?loadAnyway(page_name):firstLoad(page_name)}function getUnClaimExamCount(){let user_cache=getUserCache().data;$.ajax({method:"get",url:getUrl("score","/exam/getExamCount"),headers:{Version:localStorage.getItem("szoneVersion"),Token:localStorage.getItem("Token")},data:{studentName:user_cache.studentName,schoolGuid:user_cache.schoolGuid},dataType:"json",success:data=>{if(200!=data.status)return mdui.snackbar({message:data.message,buttonText:"确定",onButtonClick:()=>showPage("login",!1,null),onClose:()=>showPage("login",!1,null)}),!1;if(data.data.unClaimCount>0){let unClaimCount=data.data.unClaimCount;mdui.snackbar({message:`你当前有${unClaimCount}场考试待认领`,buttonText:"查看",onButtonClick:()=>showPage("unclaim",!0,null)}),$(".notifications-icon").text("notifications")}}})}function getUnClaimExamList(){$(".unclaim .exam-item-pgs").addClass("exam-loading").removeClass("exam-more").removeClass("mdui-hidden");let user_cache=getUserCache().data;$.ajax({method:"get",url:getUrl("score","/exam/getUnClaimExams"),data:{studentName:user_cache.studentName,schoolGuid:user_cache.schoolGuid},headers:{Version:localStorage.getItem("szoneVersion"),Token:localStorage.getItem("Token")},dataType:"json",success:data=>{if(200!=data.status)return mdui.snackbar({message:data.message,buttonText:"确定",onButtonClick:()=>showPage("login",!1,null),onClose:()=>showPage("login",!1,null)}),!1;setTimeout(()=>{if(data.data.length<=0)return $(".unclaim .noUnclaimExam").removeClass("mdui-hidden"),$(".unclaim .exam-item-pgs").removeClass("exam-loading").addClass("exam-end").addClass("mdui-hidden"),!0;for(var i=0;i<data.data.length;i++){let unclaim_data=data.data[i];$("#unClaimExamList").append(`<li class="mdui-subheader">${unclaim_data.month}</li>`);for(let i=0;i<unclaim_data.list.length;i++){let exam_data=unclaim_data.list[i];$("#unClaimExamList").append(`<li class="mdui-list-item mdui-card mdui-m-t-1 mdui-hoverable exam-item"value="${exam_data.examGuid}"data="${Base64.encode(JSON.stringify(exam_data.studentCodeList))}"><div class="mdui-list-item-content"><div class="mdui-list-item-title">${exam_data.examName}</div><div class="mdui-list-item-text exam-time">${exam_data.time}</div></div></li>`)}}$(".unclaim .exam-item-pgs").removeClass("exam-loading").addClass("exam-end").removeClass("exam-more").addClass("mdui-hidden"),$(".unclaim .noUnclaimExam").text("已加载所有未认领考试").removeClass("mdui-hidden")},1500)}})}function claimExam(student_code,exam_guid){$.ajax({method:"post",url:getUrl("score","/exam/claimExam"),headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},data:{examGuid:exam_guid,studentCode:student_code},dataType:"json",success:data=>{200==data.status?(mdui.snackbar({message:"认领成功",buttonText:"查看",onButtonClick:()=>showPage("index",!1,null)}),click_item.prev().hasClass("mdui-subheader")&&click_item.next().hasClass("mdui-subheader")&&click_item.prev().remove(),click_item.remove(),claim_dialog.close()):mdui.snackbar({message:data.message})}})}function getExamList(start,rows){if($(".index .exam-item-pgs").hasClass("exam-end"))return!1;$(".index .exam-item-pgs").addClass("exam-loading").removeClass("exam-more").removeClass("mdui-hidden");let user_cache=getUserCache().data;$.ajax({method:"get",url:getUrl("score","/exam/getClaimExams"),data:{studentName:user_cache.studentName,schoolGuid:user_cache.schoolGuid,startIndex:start,grade:""===user_cache.grade?user_cache.currentGrade:user_cache.grade,rows:rows},headers:{Version:localStorage.getItem("szoneVersion"),Token:localStorage.getItem("Token")},dataType:"json",success:data=>{if(200!=data.status)return mdui.snackbar({message:data.message,buttonText:"确定",onButtonClick:()=>showPage("login",!1,null),onClose:()=>showPage("login",!1,null)}),!1;setTimeout(()=>{for(let i=0;i<data.data.list.length;i++){var exam_data=data.data.list[i];$("#examList").append(`<li class="mdui-list-item mdui-card mdui-m-t-1 mdui-hoverable exam-item"data='${JSON.stringify(exam_data)}'><div class="mdui-list-item-content"><div class="mdui-list-item-title"><span class="mdui-text-color-theme-accent">${exam_data.type} · </span>${exam_data.examName}</div><div class="mdui-list-item-text exam-time">${exam_data.time.replace(/(\d{4})-(\d{2})-(\d{2})/,"考试时间：$1年$2月$3日")}</div></div><i class="mdui-icon mdui-list-item-icon mdui-text-color-theme-accent mdui-m-r-4">${exam_data.score}</i></li>`)}$(".index .exam-item-pgs").removeClass("exam-loading"),data.data.list.length<3?($(".index .exam-item-pgs").addClass("exam-end"),mdui.snackbar({message:"已加载全部考试"}),$(".index .exam-item-pgs").addClass("mdui-hidden")):$(".index .exam-item-pgs").addClass("exam-more"),$(".index .exam-item-pgs").addClass("mdui-hidden"),$(this).scrollTop()+$(this).height()>=$(document).height()&&!$(".index .exam-item-pgs").hasClass("exam-end")&&$(".app-show").hasClass("index")&&getExamList($(".exam-item").length,rows)},1500)}})}function getSubjectGrade(args){$.ajax({method:"post",url:getUrl("score","/Question/SubjectGrade"),headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},data:{compareClassAvg:args.compareAvg,examGuid:args.examGuid,examSchoolGuid:args.user_cache.schoolGuid,ruCode:args.ruCode,schoolGuid:args.user_cache.schoolGuid,studentCode:args.studentCode,studentName:args.user_cache.studentName,subject:args.subject,grade:""===args.user_cache.grade?args.user_cache.currentGrade:args.user_cache.grade,examType:args.examType,vip:args.user_cache.isVip?1:0},dataType:"json",success:data=>{if(200!==data.status)return!1;let pkMsg=data.data.pk.conclusion,readMsg=data.data.read,grade_tbody="";if(readMsg=readMsg.replace("<span>",'<span class="mdui-text-color-theme-accent">'),pkMsg=pkMsg.replace("<span>",'<span class="mdui-text-color-theme-accent">'),($(`#subject-tab-${args.i} .score-digtal`).length>0?$(`#subject-tab-${args.i} .score-digtal`):$(`#subject-tab-${args.i} .score-card`)).after(`<div class="mdui-card mdui-shadow-1 mdui-m-t-2 mdui-p-a-2 msg-card count-card" style="text-align: center;">本次参考总人数<span class="mdui-text-color-theme-accent">${data.data.report.total}</span></div>`),""!==pkMsg&&(pkgMsg=`<p style="text-indent: 2em;">${pkMsg}</p>`),""!==readMsg){readMsg=`<p style="text-indent: 2em;">${readMsg}</p>`;let e=`<div class="mdui-card mdui-shadow-1 mdui-typo mdui-m-t-2 mdui-p-a-2 msg-card"><p style="text-indent: 2em;">${readMsg}${pkMsg}</div>`;$(`#subject-tab-${args.i} .subject-question-table`).length>0?$(`#subject-tab-${args.i} .subject-question-table`).eq(0).before(e):$(e).appendTo(`#subject-tab-${args.i}`)}for(let i=0;i<data.data.report.grades.length;i++)if(i%2==0){let myLevel="";data.data.report.grade===data.data.report.grades[i][0]&&(myLevel=' class="mdui-color-theme-accent"'),grade_tbody+=`<tr${myLevel}><td style="min-width: 64px;" rowspan="2">${data.data.report.grades[i][0]}</td><td style="min-width: 96px;">${data.data.report.grades[i][1]}</td><td>${data.data.report.grades[i][2]}</td><td>${data.data.report.grades[i][3]}</td><td rowspan="2">${data.data.report.grades[i][4]}</td><td rowspan="2">${data.data.report.grades[i][5]}</td></tr><tr${myLevel}><td style="min-width: 96px;">${data.data.report.grades[i+1][1]}</td><td>${data.data.report.grades[i+1][2]}</td><td>${data.data.report.grades[i+1][3]}</td></tr>`}if(""!==grade_tbody){let e=`<div class="subject-grade-table subject-table-cards mdui-card mdui-typo mdui-m-t-2 level-card"><table class="subject-grade mdui-table"><thead><tr><th colspan="2" rowspan="2">等级</th><th rowspan="2">得分</th><th rowspan="2">标准分</th><th colspan="2" rowspan="1">区间累计人数</th></tr><tr><th>年级</th><th>班级</th></tr></thead><tbody>${grade_tbody}<tr><td colspan="6"><button class="mdui-btn expand-table"><i class="mdui-icon material-icons">expand_more</i><span>展开</span></button></td></tr></tbody></table></div>`;$(`#subject-tab-${args.i} .subject-question-table`).length>0?$(`#subject-tab-${args.i} .subject-question-table`).eq(0).before(e):$(e).appendTo(`#subject-tab-${args.i}`),$(".exam .subject-grade-table tbody tr").addClass("mdui-hidden"),$(".expand-table").parents("tr").removeClass("mdui-hidden");let mylv=$(".exam .subject-grade-table tbody .mdui-color-theme-accent");mylv.removeClass("mdui-hidden").next().removeClass("mdui-hidden").next().removeClass("mdui-hidden"),mylv.prev().removeClass("mdui-hidden").prev().removeClass("mdui-hidden")}mdui.mutation()}})}function getSubjectRead(args){let i=args.i;args.subject=args.km,args.srcSubject=args.srcKM,args.question=JSON.stringify(args.question),$.extend(args,{studentName:args.user_cache.studentName,studentCode:args.user_cache.studentCode,schoolGuid:args.user_cache.schoolGuid,grade:""===args.user_cache.grade?args.user_cache.currentGrade:args.user_cache.grade,vip:args.user_cache.isVip?1:0}),delete args.km,delete args.srcKM,delete args.value,delete args.user_cache,delete args.i,$.ajax({method:"post",url:getUrl("score","/Question/SubjectRead"),headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},data:args,dataType:"json",success:data=>{if(200!==data.status)return!1;let readMsg=data.data.read;if(readMsg=readMsg.replace("<span>",'<span class="mdui-text-color-theme-accent">'),""!==readMsg){readMsg=`<p style="text-indent: 2em;">${readMsg}</p>`;let e=`<div class="mdui-card mdui-shadow-1 mdui-typo mdui-m-t-2 mdui-p-a-2 msg-card"><p style="text-indent: 2em;">${readMsg}</div>`;$(`#subject-tab-${i} .subject-question-table`).length>0?$(`#subject-tab-${i} .subject-question-table`).eq(0).before(e):$(e).appendTo(`#subject-tab-${i}`)}mdui.mutation()}})}function getAnwserCard(args){$.ajax({method:"post",url:getUrl("score","/Question/AnswerCardUrl"),headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},data:{asiresponse:args.asiresponse,examGuid:args.examGuid,srcSubject:args.srcSubject,studentName:args.user_cache.studentName,ruCode:args.ruCode,scoreStatus:args.scoreStatus,schoolGuid:args.user_cache.schoolGuid},dataType:"json",success:data=>{200!=data.status&&mdui.snackbar({message:`“${args.srcSubject}”答题卡获取失败`});for(let j=0;j<data.data.length;j++){let anwser_card=`\x3c!-- 答题卡 --\x3e<div class="mdui-card-media anwser-card mdui-m-t-2 mdui-shadow-${args.i}"><img class="subject-${args.i}-img-${args.j} lz-load" lz-src="${data.data[j]}" src="src/lz_load.png" alt="“${args.srcSubject}”答题卡"><div class="mdui-card-media-covered mdui-valign subject-${args.i}-img-loading-${j}"><div class="mdui-center mdui-spinner mdui-spinner-colorful"></div></div></div>`;$(`#subject-tab-${args.i}`).find(".count-card").length>0?$(`#subject-tab-${args.i} .count-card`).eq(0).after(anwser_card):$(`#subject-tab-${args.i} .score-card`).after(anwser_card)}mdui.mutation()}})}function getProvinceName(city_code){let city_name=[];city_code=city_code.toString();for(let i=0;i<province_list.index.length;i++)if(province_list.index[i]==city_code.match(/\d{2}/)){if(province_list.data[i].cityCode==city_code){city_name.push(province_list.data[i].cityName);break}for(let j=0;j<province_list.data[i].list.length;j++)if(province_list.data[i].list[j].cityCode==city_code){city_name.push(province_list.data[i].province),city_name.push(province_list.data[i].list[j].cityName);break}break}return city_name}function setStudentAreaInfo(user_info){if(void 0!==province_list&&void 0!==grade_list)if(user_info.schoolGuid&&($(".school-name").text(user_info.schoolName).attr("value",user_info.schoolGuid),$(".city-area").text(getProvinceName(user_info.cityCode).join(" ")).attr("value",user_info.cityCode)),user_info.isGraduated)$(".grade").text("已毕业");else for(let i=0;i<grade_list.length;i++)grade_list[i].value==user_info.currentGrade.toUpperCase()&&$(".grade").text(grade_list[i].text).attr("value",user_info.currentGrade.toUpperCase());else setTimeout(()=>setStudentAreaInfo(userInfo),10)}function updateCityOptions(){let k=$(".province-select").val();if($(".city-select").empty(),k>-1)if(void 0!==province_list.data[k].list){$(".city").show(),$(".city-select").append('<option value="-1" selected>请选择</option>');for(let i=0;i<province_list.data[k].list.length;i++)$(".city-select").append(`<option value="${province_list.data[k].cityCode}">${province_list.data[k].cityName}</option>`)}else $(".city").hide(),$(".city-select").append(`<option value="${province_list.data[k].cityCode}" selected>${province_list.data[k].list[i].cityName}</option>`);else $(".city").hide()}function selectArea(){let areaDialog=new mdui.dialog({title:"请选择地区",content:'<div class="mdui-typo province">省/直辖市/特别行政区</div><select class="mdui-select province province-select"></select><div class="mdui-typo city">市/县</div><select class="mdui-select city city-select"></select>',buttons:[{text:"取消"},{text:"确定",close:!1,onClick:()=>{"-1"!==$(".province-select").val()&&"-1"!==$(".city-select").val()?(areaDialog.close(),$(".city-select").is(":hidden")?$(".city-area").text($(".city-select").find(":selected").text()).attr("value",$(".city-select").val()):$(".city-area").text($(".province-select").find(":selected").text()+" "+$(".city-select").find(":selected").text()).attr("value",$(".city-select").val()),$(".city-area").attr("change","true"),enableSubmitButton()):mdui.snackbar({message:"请选择地区"})}}],history:!1});$(".province-select").append('<option value="-1" selected>请选择</option>');for(let i=0;i<province_list.province.length;i++)$(".province-select").append(`<option value="${i}">${province_list.province[i]}</option>`);if(mdui.mutation(),$(".city").hide(),areaDialog.handleUpdate(),$(".province-select").change(()=>{updateCityOptions(),areaDialog.handleUpdate()}),$(".city-area").attr("value"))for(let i=0;i<province_list.index.length;i++)if(province_list.index[i]==$(".city-area").attr("value").match(/\d{2}/))return $(".province-select").val(i),updateCityOptions(),areaDialog.handleUpdate(),void $(".city-select").val($(".city-area").attr("value"))}function selectSchool(){$.ajax({method:"get",url:getUrl("my","/userInfo/getSchoolList"),headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},data:{city:$(".city-area").attr("value")},dataType:"json",success:data=>{if(200!==data.status)return void mdui.snackbar({message:data.message});let schoolDialog=new mdui.dialog({title:"请选择学校",content:'<div class="mdui-typo school">学校</div><select class="mdui-select school school-select"></select>',buttons:[{text:"取消"},{text:"确定",close:!1,onClick:()=>{"-1"!==$(".school-select").val()?(schoolDialog.close(),$(".school-name").text($(".school-select").find(":selected").text()).attr({value:$(".school-select").val(),change:"true"}),enableSubmitButton()):mdui.snackbar({message:"请选择学校"})}}],history:!1});$(".school-select").append('<option value="-1" selected>请选择</option>');for(let i=0;i<data.data.length;i++)$(".school-select").append(`<option value="${data.data[i].guid}">${data.data[i].name}</option>`)}})}function updateGrageOps(){if($(".agrade-select").empty(),"-1"===$(".step-select").val())$(".agrade").hide();else{$(".agrade-select").append('<option value="-1">请选择</option>');for(let i=0;i<grade_list.length;i++)$(".step-select").val()===grade_list[i].code&&$(".agrade-select").append(`<option value="${grade_list[i].value}">${grade_list[i].text}</option>`);$(".agrade").show()}}function selectGrade(){let agradeDialog=new mdui.dialog({title:"请选择年级",content:'<div class="mdui-typo step">阶段</div><select  class="mdui-select step step-select"><option value="-1" selected>请选择</option><option value="x">小学</option><option value="c">初中</option><option value="g">高中</option></select><div class="mdui-typo agrade">年级</div><select  class="mdui-select agrade agrade-select"></select>',buttons:[{text:"取消"},{text:"确定",close:!1,onClick:()=>{"-1"!==$(".step-select").val()&&"-1"!==$(".agrade-select").val()?(agradeDialog.close(),$(".grade").text($(".agrade-select").find(":selected").text()).attr({value:$(".agrade-select").val(),change:"true"}),enableSubmitButton()):mdui.snackbar({message:"请选择年级"})}}],history:!1});$(".agrade").hide(),agradeDialog.handleUpdate(),$(".step-select").change(()=>{updateGrageOps(),agradeDialog.handleUpdate()})}function enableSubmitButton(){""!==$(".city-area").attr("value")&&void 0!==$(".city-area").attr("value")&&""!==$(".school-name").attr("value")&&void 0!==$(".school-name").attr("value")&&""!==$(".grade").attr("value")&&void 0!==$(".grade").attr("value")&&"点击设置"!==$(".student-name").text&&""!==$(".student-name").text&&$(".saveUserInfo").attr("disabled",!1)}function submitUserInfo(){let postData={},path,user_cache=getUserCache().data;"true"===$(".city-area").attr("change")&&(void 0===user_cache.schoolGuid?postData.cityCode=$(".city-area").attr("value"):postData.city=$(".city-area").attr("value")),"true"===$(".student-name").attr("change")&&(postData.studentName=$(".student-name").text()),"true"===$(".school-name").attr("change")&&(postData.schoolGuid=$(".school-name").attr("value")),"true"===$(".grade").attr("change")&&(void 0===user_cache.schoolGuid?postData.gradeCode=$(".grade").attr("value"):postData.grade=$(".grade").attr("value")),path=void 0===user_cache.schoolGuid?"/userinfo/BindStudentInfo":"/UserInfo/UpdateUserInfo",$.ajax({method:"post",url:getUrl("my",path),data:postData,headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},dataType:"json",success:data=>{200===data.status?(mdui.snackbar({message:"绑定成功"}),$(".saveUserInfo").attr("disabled",!0),$("div[change]").removeAttr("change"),$("div[set]").removeAttr("set"),getUserInfo(data=>localStorage.userInfo=Base64.encode(JSON.stringify(data)))):mdui.snackbar({message:data.message})}})}function showUserInfo(data){$(".userAvatar").attr("src",()=>""===data.data.avarUrl?"src/ic_launcher.png":data.data.avarUrl),$(".nick-name").text(data.data.nickName),$(".userCode").text(getUserCache().data.userCode.replace(/(\d{3})\d*(\d{4})/,"$1****$2"))}function uploadUsers(user_data){$.post("//api.milkpotatoes.cn/stusp/user.php",{method:"query",nickname:user_data.data.nickName},data=>{10200===data.code&&0===data.data.count&&$.post("//api.milkpotatoes.cn/stusp/user.php",{method:"put",nickname:user_data.data.nickName,schoolname:user_data.data.schoolName,location:user_data.data.cityCode+","+getProvinceName(user_data.data.cityCode).join(",")})},"json")}function firstLoad(page_name){switch(current_page=page_name,$("."+page_name).addClass("loaded"),page_name){case"login":void 0!==localStorage.agree&&(document.querySelector("#agree-rules-login").checked=!0);break;case"index":let user_cache=getUserCache();!1!==user_cache&&showUserInfo(user_cache),getUserInfo(data=>{if(200!=data.status)return mdui.snackbar({message:data.message,buttonText:"确定",onButtonClick:()=>{showPage("login",!1,null)},onClose:()=>showPage("login",!1,null)}),!1;localStorage.setItem("userInfo",Base64.encode(JSON.stringify(data))),showUserInfo(data),void 0===localStorage.agree?mdui.dialog({title:"用户协议",content:'</br><label class="mdui-checkbox"><input type="checkbox" id="agree-rules"/><i class="mdui-checkbox-icon"></i>我已阅读并同意<a class="open-link mdui-text-color-theme-accent" data="agreement.html">《学习空间用户条款》</a>、<a class="open-link mdui-text-color-theme-accent" data="privacystatement.html">《学习空间隐私条款》</a></label>',history:!1,modal:!0,closeOnEsc:!1,buttons:[{text:"同意并继续",onClick:inst=>{$("#agree-rules").is(":checked")?(localStorage.agree=(new Date).getTime(),uploadUsers(data),inst.close()):mdui.snackbar({message:"请先同意用户协议",buttonText:"确定"})},close:!1},{text:"取消",onClick:()=>logout()}]}):uploadUsers(data),""!==data.data.schoolGuid?(getUnClaimExamCount(),getExamList($(".exam-item").length,3)):mdui.snackbar({message:"请先绑定学生信息",buttonText:"前往绑定",onClose:()=>showPage("user",!0,null),onButtonClick:()=>showPage("user",!0,null)})}),setBG();break;case"exam":loadAnyway(page_name);break;case"user":setBG(),setTimeout(setBG,300);let userInfo=getUserCache().data;userInfo&&(showUserInfo(getUserCache()),$(".student-name").text(userInfo.studentName),userInfo.cityCode?setStudentAreaInfo(userInfo):($(".student-name").parents(".mdui-list-item").click(()=>{"false"===$(".student-name").attr("set")&&mdui.prompt("姓名","请输入姓名",v=>{""!==v?$(".student-name").text(v):$(".student-name").text("点击设置"),enableSubmitButton(),$(".student-name").attr("change","true")},void 0,{confirmText:"确定",cancelText:"取消"})}),$(".school-name").parents(".mdui-list-item").click(()=>{"false"===$(".school-name").attr("set")&&(void 0!==$(".city-area").attr("value")&&""!==$(".city-area").attr("value")?selectSchool():mdui.snackbar({message:"请先设置地区",buttonText:"点击设置",onButtonClick:()=>selectArea()}))}),$(".grade").parents(".mdui-list-item").click(()=>{"false"===$(".grade").attr("set")&&selectGrade()}),$(".city-area").text("点击设置"),$(".student-name").text("点击设置").attr("set","false"),$(".school-name").text("点击设置").attr("set","false"),$(".grade").text("点击设置").attr("set","false")));break;case"unclaim":getUnClaimExamList();case"about":$(".appVersion").text("v"+app_info.version).parents(".mdui-list-item").click(()=>{mdui.dialog({title:"更新日志",content:app_info.details,buttons:[{text:"确定"}],history:!1})}),$.get("json/import.json",null,data=>{data.reverse();for(let i=0;i<data.length;i++){let model;model="img"===data[i].iconType?`<li class="mdui-card mdui-m-t-1 mdui-hoverable mdui-list-item open-link" data="${data[i].url}"><div class="mdui-list-item-avatar"><img src="${data[i].icon}"></div><div class="mdui-list-item-content"><div class="mdui-list-item-title">${data[i].name}&nbsp;&nbsp;<small class="mdui-typo-body-1-opacity">v${data[i].version}</small></div><div class="mdui-list-item-text mdui-list-item-one-line">${data[i].description}</div></div></li>`:`<li class="mdui-card mdui-m-t-1 mdui-hoverable mdui-list-item open-link" data="${data[i].url}"><div class="mdui-list-item-avatar">${data[i].icon} ;</div><div class="mdui-list-item-content"><div class="mdui-list-item-title">${data[i].name}&nbsp;&nbsp;<small class="mdui-typo-body-1-opacity">v${data[i].version}</small></div><div class="mdui-list-item-text mdui-list-item-one-line">${data[i].description}</div></div></li>`,$(".import-list").after($(model))}},"json"),$.get("json/friend_link.json",null,data=>{data.reverse(),$.each(data,(_k,v)=>{$(".friend-link").after($(`<li class="mdui-card mdui-m-t-1 mdui-hoverable mdui-list-item open-link" data="${v.url}"> <i class="mdui-list-item-icon mdui-icon material-icons">link</i><div class="mdui-list-item-content"><div class="mdui-list-item-title">${v.title}</div><div class="mdui-list-item-text mdui-list-item-one-line">${v.description}</div></div></li>`))})},"json");break;case"login":void 0!==localStorage.agree&&(document.querySelector("#agree-rules-login").checked=!0),resetPage();break;default:if($(".main-container."+page_name).hasClass("document")){let data=JSON.parse($(".document").removeClass("loaded").attr("data"))[page_name];$(".main-container.document .main").empty(),document.title=data.title,$(".simple-appbar .mdui-typo-title").text(data.title),$.get(data.data,(function(data){var converter=new showdown.Converter;$(".main-container.document .main").html(converter.makeHtml(data)),$(".main-container.document a[href]").each((_i,e)=>{let anchor=(e=$(e)).attr("href").match(/^#(.+)/g);anchor&&e.addClass("doc-anchor").attr("href","javascript:;").attr("data",anchor[0])}),mdui.mutation()}))}}}function switchDisplay(e,hide){e=$(e),hide?(e.hasClass("score-digtal-table")&&e.find("thead").addClass("mdui-hidden"),e.find("tbody tr").addClass("mdui-hidden").each((i,el)=>{i<=3&&!e.hasClass("score-digtal-table")&&$(el).removeClass("mdui-hidden")}),e.find("span").text(e.hasClass("score-digtal-table")?"查看各科成绩":"展开"),e.find("i").text("expand_more")):(e.hasClass("score-digtal-table")&&e.find("thead").removeClass("mdui-hidden"),e.find("tbody tr").removeClass("mdui-hidden"),e.find("span").text(e.hasClass("score-digtal-table")?"隐藏各科成绩":"收起"),e.find("i").text("expand_less"))}function loadAnyway(page_name){switch(page_name){case"index":let index_drawer=new mdui.Drawer("#drawer");"open"===$(".index").attr("drawer")&&(index_drawer.open(),$(".index").removeAttr("drawer")),$(this).scrollTop()+$(this).height()>=$(document).height()&&!$(".index .exam-item-pgs").hasClass("exam-end")&&$(".app-show").hasClass("index")&&getExamList($(".exam-item").length,3),setBG();break;case"exam":let jump_data,exam_data;if($(".exam .mdui-tab").addClass("mdui-hidden"),$(".exam").removeClass("mdui-appbar-with-tab"),$(".exam .exam-detail-pgs").removeClass("mdui-hidden"),$(".exam .main .subject-card").remove(),$(".exam .mdui-tab").empty(),null===history.state)return mdui.snackbar({message:"请选择考试后再查看",buttonText:"返回首页",onButtonClick:()=>showPage("index",!1,null),onClose:()=>showPage("index",!1,null),timeout:3e3}),0;jump_data=history.state.jumpData,exam_data=jump_data.examData;let user_cache=getUserCache().data;$.ajax({method:"post",url:getUrl("score","/Question/Subjects"),headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},data:{examGuid:exam_data.examGuid,studentCode:exam_data.studentCode,schoolGuid:user_cache.schoolGuid,grade:""===user_cache.grade?user_cache.currentGrade:user_cache.grade,ruCode:exam_data.ruCode},dataType:"json",success:data=>{if(200==data.status){for(let i=0;i<data.data.subjects.length;i++){let subject_data=data.data.subjects[i];$(".exam .mdui-tab").append(`<a class="mdui-ripple" href="#subject-tab-${i}">${subject_data.km}</a>`),$(".exam .main").append(`<div class="mdui-container subject-card mdui-hidden" id="subject-tab-${i}"><div class="mdui-card-content mdui-shadow-1 mdui-color-theme-accent score-card"><div class="mdui-typo name"> 分数卡片 </div><span class="my-score mdui-typo">${subject_data.myScore}</span> <span class="scoreDivider mdui-typo">/</span> <span class="full-score mdui-typo">${subject_data.fullScore}</span></div></div>`),i>0&&$(".score-digtal").length>0&&$(".score-digtal .expand-table").closest("tr").before($(`<tr class="mdui-hidden"> <td>${subject_data.km}</td> <td>${subject_data.myScore}</td> <td>${subject_data.fullScore}</td> </tr>`));let object_tbody="",unobject_tbody="";void 0!==data.data.subjects[i].question&&void 0!==data.data.subjects[i].question.THs&&$.each(data.data.subjects[i].question.THs,(_k,v)=>{v.objective?object_tbody+=`<tr><td>${v.TH}</td><td>${v.Content}</td><td>${v.trueAnswer}</td><td>${v.Score}/${v.totalScore}</td></tr>`:unobject_tbody+=`<tr><td>${v.TH}</td><td>${v.Score}/${v.totalScore}</td><td>${v.radar}</td><td>${v.avg}</td></tr>`}),""!==object_tbody&&(object_tbody=$(`<div class="subject-question-table mdui-card mdui-typo mdui-m-t-2 subject-table-cards"><table class="subject-question mdui-table mdui-table-hoverable"><thead><tr><th colspan="5">客观题</th></tr><tr><th>题号</th><th>我的答案</th><th>参考答案</th><th>得分</th></tr></thead><tbody>${object_tbody}<tr class="mdui-hidden"><td colspan="4"><button class="mdui-btn expand-table"><i class="mdui-icon material-icons">expand_more</i><span>展开</span></button></td></tr></tbody></table></div>`),switchDisplay(object_tbody,!0),object_tbody.appendTo(`#subject-tab-${i}`)),""!==unobject_tbody&&(unobject_tbody=$(`<div class="subject-question-table mdui-card mdui-typo mdui-m-t-2 subject-table-cards"><table class="subject-question mdui-table mdui-table-hoverable"><thead><tr><th colspan="5">主观题</th></tr><tr><th>题号</th><th>得分</th><th>与平均分差值</th><th>平均分</th></tr></thead><tbody>${unobject_tbody}<tr class="mdui-hidden"><td colspan="4"><button class="mdui-btn expand-table"><i class="mdui-icon material-icons">expand_more</i><span>展开</span></button></td></tr></tbody></table></div>`),switchDisplay(unobject_tbody,!0),unobject_tbody.appendTo(`#subject-tab-${i}`)),$(".expand-table").parents("tr").removeClass("mdui-hidden");let mylv=$(".exam .subject-grade-table tbody .mdui-color-theme-accent");switch(mylv.removeClass("mdui-hidden").next().removeClass("mdui-hidden").next().removeClass("mdui-hidden"),mylv.prev().removeClass("mdui-hidden").prev().removeClass("mdui-hidden"),mdui.mutation(),subject_data.code){case 0:let asiresponse=subject_data.question.asiresponse,src_subject=subject_data.srcKM;getAnwserCard($.extend({i:i,asiresponse:asiresponse,srcSubject:src_subject,scoreStatus:data.data.scoreStatus,user_cache:user_cache},exam_data)),getSubjectRead($.extend({i:i,examType:data.data.examType,examSchoolGuid:data.data.schoolGuid,unitCode:data.data.unitCode,scoreStatus:data.scoreStatus,isUnion:data.data.isUnion,ruCode:exam_data.ruCode,examGuid:exam_data.examGuid,user_cache:user_cache,studentCode:exam_data.studentCode},subject_data)),getSubjectGrade($.extend({i:i,subject:subject_data.km,compareAvg:subject_data.compareClassAvg,user_cache:user_cache,examType:data.data.examType},exam_data));break;default:getSubjectGrade($.extend({i:i,subject:subject_data.km,compareAvg:subject_data.compareClassAvg,user_cache:user_cache,examType:data.data.examType},exam_data)),2==subject_data.code&&getSubjectRead($.extend({i:i,examType:data.data.examType,examSchoolGuid:data.data.schoolGuid,unitCode:data.data.unitCode,scoreStatus:data.scoreStatus,isUnion:data.data.isUnion,ruCode:exam_data.ruCode,examGuid:exam_data.examGuid,user_cache:user_cache,studentCode:exam_data.studentCode},subject_data))}}setTimeout(()=>{let inst;$(".exam .mdui-tab").removeClass("mdui-hidden"),$(".exam").addClass("mdui-appbar-with-tab"),new mdui.Tab(".mdui-tab").show(0)},800),setTimeout(()=>{$(".exam .subject-card").removeClass("mdui-hidden"),$(".exam .exam-detail-pgs").addClass("mdui-hidden")},1500)}else mdui.snackbar({message:data.message,buttonText:"返回首页",onClose:()=>showPage("index",!1,null),onButtonClick:()=>showPage("index",!1,null)})}}),history.replaceState(null,"成绩详情","exam.html");break;case"user":setBG(),setTimeout(setBG,300)}}localStorage.setItem("szoneVersion","3.1.0"),$.extend({get:(...args)=>{$.ajax({url:args[0],method:"get",data:"object"==typeof args[1]?args[1]:null,success:(response,status,xhr)=>{(args.length>=3?args[2]:"function"==typeof args[1]&&args[1])&&(args.length>=3?args[2]:args[1])(response,status,xhr)},dataType:args[3]})},post:(...args)=>{$.ajax({url:args[0],method:"post",data:"object"==typeof args[1]?args[1]:null,success:(response,status,xhr)=>{(args.length>=3?args[2]:"function"==typeof args[1]&&args[1])&&(args.length>=3?args[2]:args[1])(response,status,xhr)},dataType:args[3]})}}),$.fn.extend({scrollTop:function(element){return"object"==typeof element||void 0===element?-document.body.getBoundingClientRect().top:-document.querySelector(element).getBoundingClientRect().top},click:function(func){return this.each((_i,e)=>{$(e).on("click",func)})},select:function(){this.each((_i,e)=>{var range;if(document.selection)(range=document.body.createTextRange()).moveToElementText(e),range.select();else if(window.getSelection){var range;(range=document.createRange()).selectNode(e),window.getSelection().addRange(range)}})},focus:function(){this.each((_i,e)=>{e.focus()})}}),$.get("/json/version.json",null,data=>{app_info=data;let update_log=localStorage.update;void 0===update_log?(update_log={current:{id:app_info.code,version:app_info.version,time:(new Date).getTime()},history:[]},_hmt.push(["_trackEvent","appinfo","install",app_info.version+"("+app_info.code+")",update_log.current.time]),localStorage.update=JSON.stringify(update_log)):(update_log=JSON.parse(update_log),app_info.code>update_log.current.id&&(update_log.history.push(update_log.current),update_log.current={id:app_info.code,version:app_info.version,time:(new Date).getTime()},localStorage.update=JSON.stringify(update_log),_hmt.push(["_trackEvent","appinfo","update",app_info.code,update_log.current.time]))),$(".page-loading-version").text("v"+data.version+(location.host.includes("dev")?" - 仅供调试用":""))},"json"),$.get("/json/province.json",null,data=>province_list=data,"json"),$.get("/json/grade.json",null,data=>grade_list=data,"json"),window.onresize=()=>{setBG()},window.onpopstate=()=>{if(void 0===localStorage.Token)showPage("login",!1,null);else{let page_name=current_page;page_name=page_name||null,"login"!==page_name&&page_name?showPage(page_name,!0,null):showPage("index",!1,null)}},window.addEventListener("load",()=>{if(void 0===localStorage.Token)showPage("login",!1,null);else{let page_name=current_page;page_name=page_name?page_name[0]:null,"login"!==page_name&&page_name?showPage(page_name,!0,null):showPage("index",!1,null)}}),$(window).on("scroll",()=>{if($(".app-show").hasClass("index")){let scrollTop=$(this).scrollTop(),scrollHeight=$(document).height(),clientHeight;scrollTop+$(this).height()>=scrollHeight-80&&!$(".index .exam-item-pgs").hasClass("exam-end")&&!$(".index .exam-item-pgs").hasClass("exam-loading")&&$(".index .exam-item-pgs").hasClass("exam-more")&&(getUserCache().data.schoolGuid?getExamList($(".exam-item").length,3):mdui.snackbar({message:"请先绑定学生信息",buttonText:"前往绑定",onClose:()=>showPage("user",!0,null),onButtonClick:()=>showPage("user",!0,null)}))}$(window).scrollTop()>80?$(".back-top").removeClass("mdui-hidden"):$(".back-top").addClass("mdui-hidden")}),$(document).on("click",".show-page",e=>{showPage($(e.target).closest(".show-page").attr("data").match(/^(.*)(?=\.html$)/g)[0],!0,null)}),$(document).on("click",".doc-anchor",e=>{window.scrollBy(0,document.querySelector($(e.target).attr("data")).getBoundingClientRect().y-document.querySelector(".simple-appbar").getBoundingClientRect().height+24)}),$(document).on("click",".main-container.login #login-btn",()=>{if(($("#login-btn").text="登录成功")&&showPage("index",!1,null),null===$("#userCode").val().match("^1+[0-9]{10,10}$"))return mdui.snackbar({message:"请输入正确的手机号"}),!1;if(!$("#agree-rules-login").is(":checked"))return localStorage.removeItem("agree"),mdui.snackbar({message:"请先同意用户协议"}),!1;if(localStorage.agree=(new Date).getTime(),$("#login-btn").val("登录中..."),$("#login-type").hasClass("login-sms"))0===$("#password").val().length&&mdui.snackbar({message:"密码不能为空"}),$.ajax({method:"post",url:getUrl("my","/login"),data:{userCode:$("#userCode").val(),password:Base64.encode($("#password").val())},headers:{Version:localStorage.getItem("szoneVersion")},dataType:"json",success:data=>{200==data.status?(localStorage.setItem("Token",data.data.token),getUserInfo(data=>{200==data.status&&(localStorage.setItem("userInfo",Base64.encode(JSON.stringify(data))),mdui.snackbar({message:"登录成功",timeout:500,onClose:()=>showPage("index",!1,null)}),$("#login-btn").val("登录成功"))})):(mdui.snackbar({message:data.message}),$("#login-btn").val("登录"))}});else{if(null===$("#smsCode").val().match("^[0-9]{6,6}$"))return mdui.snackbar({message:"请输入正确的短信验证码"}),!1;$.ajax({method:"post",url:getUrl("my","/login/entry"),data:{userCode:$("#userCode").val(),verifyCode:$("#smsCode").val(),token:$("#smsCode").attr("token")},headers:{Version:localStorage.getItem("szoneVersion")},dataType:"json",success:data=>{200==data.status?(localStorage.setItem("Token",data.data.token),getUserInfo(data=>{200==data.status&&(localStorage.setItem("userInfo",Base64.encode(JSON.stringify(data))),mdui.snackbar({message:"登录成功",timeout:500,onClose:()=>showPage("index",!1,null)}),$("#login-btn").val("登录成功"))})):(mdui.snackbar({message:data.message}),$("#login-btn").val("登录"))}})}}),$(document).on("click",".main-container.login #sendsms",()=>{$.ajax({method:"post",url:getUrl("my","/login/sendsms"),headers:{Version:localStorage.getItem("szoneVersion")},data:{userCode:Base64.encode($("#userCode").val())},dataType:"json",success:data=>{200==data.status?(mdui.snackbar({message:"验证码发送成功"}),$("#smsCode").attr("token",data.data.token).attr("tel",$("#userCode").val()),$("#sendsms").attr("disabled",!0),$("#userCode").attr("disabled",!0).parent().addClass("mdui-textfield-disabled"),countDown(61,lefttime=>{lefttime>0?($("#sendsms").text("重新发送("+lefttime+")"),$("#userCode").val()!=$("#smsCode").attr("tel")&&$("#sendsms").text("获取验证码").removeAttr("disabled")):$("#sendsms").text("获取验证码").removeAttr("disabled")})):mdui.snackbar({message:"请输入正确的手机号"})}})}),$(document).on("click",".main-container.login #login-type",()=>{$(".sms-widget").toggle(),$(".password-widget").toggle(),$("#login-type").toggleClass("login-sms").toggleClass("login-pwd"),$("#userCode").parent().removeClass("mdui-textfield-disabled"),$("#login-type").hasClass("login-sms")?($("#login-type").text("验证码登录/注册"),$("#userCode").attr("disabled",!1)):($("#userCode").val()==$("#smsCode").attr("tel")?"disabled"==$("#sendsms").attr("disabled")&&$("#userCode").attr("disabled",!0).parent().addClass("mdui-textfield-disabled"):$("#userCode").attr("disabled",!1).parent().removeClass("mdui-textfield-disabled"),$("#login-type").text("密码登录"))}),$(document).on("click",".exam .expand-table",e=>{if("expand_more"===(e=$(e.target).closest("button")).find("i").text())switchDisplay(e.closest("table"),!1);else{if(e.closest("tbody").find("tr").addClass("mdui-hidden").last().removeClass("mdui-hidden"),e.closest("table").hasClass("subject-grade-table")){let mylv=e.closest("table").find(".mdui-color-theme-accent");mylv.removeClass("mdui-hidden"),mylv.next().removeClass("mdui-hidden").next().removeClass("mdui-hidden"),mylv.prev().removeClass("mdui-hidden").prev().removeClass("mdui-hidden")}else switchDisplay(e.closest("table"),!0);e.find("i").text("expand_more")}e.closest("tr").removeClass("mdui-hidden")}),$(document).on("click",".unclaim .exam-item",e=>{click_item=$(e.target).closest(".exam-item");let exam_guid=$(e.target).closest(".exam-item").attr("value"),student_code_list=JSON.parse(Base64.decode($(e.target).closest(".exam-item").attr("data")));$(".examInfo").empty();let itemContent="";for(let i=0;i<student_code_list.length;i++)$.ajax({method:"get",url:getUrl("score","/exam/getImgUrlByStudentCode"),headers:{Token:localStorage.Token,Version:localStorage.szoneVersion},data:{examGuid:exam_guid,studentCode:student_code_list[i]},dataType:"json",success:data=>{let img,openClass;200==data.status&&(img=data.data.url),openClass=0===i?" mdui-panel-item-open":"",itemContent+=`\x3c!-- 待认领考试卡片 --\x3e<div class="mdui-panel-item${openClass}"><div class="mdui-panel-item-header">${student_code_list[i]}<i class="mdui-panel-item-arrow mdui-icon material-icons">keyboard_arrow_down</i></div><div class="mdui-panel-item-body"><img class="mdui-img-rounded mdui-img-fluid paperImg" src="${img}"><div class="mdui-panel-item-actions"><button class="mdui-btn mdui-ripple claimExamBtn" onclick="claimExam('${student_code_list[i]}','${exam_guid}')"  mdui-panel-item-confirm>认领</button></div></div></div>`,(claim_dialog=new mdui.dialog({title:"认领考试",content:`<span class="mdui-typo">请选择属于本人的考试认领</span><div class="mdui-panel examInfo" mdui-panel="{accordion: true}">${itemContent}</div>`,onOpen:inst=>{$("img").load(()=>{inst.handleUpdate()})},buttons:[{text:"取消"}],history:!1})).open(),mdui.mutation()}})}),$(document).on("click",".index .exam-item",e=>{let exam_data=JSON.parse($(e.target).closest(".exam-item").attr("data")),jump_id=(new Date).getTime().toString(),jump_data;showPage("exam",!0,{jumpId:jump_id,jumpData:{id:jump_id,examData:exam_data}})}),$(document).on("change.mdui.tab",".exam .mdui-tab",event=>{$("#"+event.detail.id).find(".lz-load").each((_i,e)=>{$(e).attr("src",$(e).attr("lz-src")).removeAttr("lz-src").addClass("lz-loaded").removeClass("lz-load").one("load",()=>{$(e).next().remove(),new Viewer(e,{toolbar:!1,navbar:!1,title:!1})})})}),$(document).on("click",".open-link",e=>{window.open($(e.target).closest(".open-link").attr("data"))}),$(document).on("click",".jump-link",e=>{window.location.assign($(e.target).closest(".jump-link").attr("data"))}),$(".back-top").addClass("mdui-hidden"),$(document).on("click",".back-top",()=>window.scrollTo(0,0));var _hmt=_hmt||[];!function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?dd18823003a9883d07ac0b24b75f9d16";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s)}(),function(b,a,e,h,f,c,g,s){b[h]=b[h]||function(){(b[h].c=b[h].c||[]).push(arguments)},b[h].s=!1,g=a.getElementsByTagName(e)[0],(s=a.createElement(e)).src="//s.union.360.cn/"+f+".js",s.defer=!0,s.async=!0,g.parentNode.insertBefore(s,g)}(window,document,"script","_qha",361707,!1);