window.addEventListener("load",()=>{const ws=io("/api/authcode"),loaddingel=document.querySelector(".loadding"),expirel=document.querySelector(".expir-note"),authel=document.querySelector(".auth-code"),json_mine_type_header=new Headers;function counter(start,len,callback){let t=new Date;t=t.getTime(),sec=60-(t-start)/1e3,sec=sec>0?sec:0,sec>0&&(setTimeout(()=>{counter(start,len,callback)},sec%1*1e3),callback&&callback(Math.round(sec)))}function getCookie(key){let reg=new RegExp(`(?<=${key}=)(.+?)(?=;|$)`,"g"),value;return document.cookie.match(reg)}function getDevicesInfo(){let deviceName=navigator.userAgent.match(/(?:Android|Windows|iPhone|Linux)(.+?)(?=;)/g);return deviceName=deviceName||"Unknown device",deviceName[0]}function setUUID(uuid){fetch("/setCookie",{method:"POST",body:JSON.stringify({deviceUUID:uuid}),headers:json_mine_type_header})}json_mine_type_header.append("Content-Type","application/json");let uuid=getCookie("DeviceUUID");uuid||(uuid=uuidv4(),setUUID(uuid)),console.log("---before send---"),ws.emit("get_auth_code",{deviceUUID:uuid,deviceName:getDevicesInfo()}),console.log("---after send---"),ws.on("authcode",data=>{let authcode=data.data.authcode;authel.innerHTML=authcode.replace(/(\d{1})/g,"<span>$1</span>"),authel.style.display="",expirel.style.display="",loaddingel.style.display="none",counter((new Date).getTime(),60,sec=>{document.querySelector(".expir-time").textContent=sec}),window.auth_expir=setTimeout(()=>{ws.emit("get_auth_code",{deviceUUID:uuid,deviceName:getDevicesInfo()})},6e4),ws.on("authed",data=>{window.clearTimeout(window.auth_expir)})})});