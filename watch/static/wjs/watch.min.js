const ws=io("/api/device");function getCookie(key){let reg=new RegExp(`(?<=${key}=)(.+?)(?=;|$)`,"g"),value=document.cookie.match(reg);return value?value[0]:value}function save_start_location(e){window.startLocation=e.changedTouches[0]}function randomFunName(){let str="abcdefghijklmnopqrstuvwxyz0123456789",name="";str=str.split(""),name=str[Math.round(26*Math.random())];for(let i=0;i<3;i++)name+=str[Math.round(36*Math.random())];return name}function alertDialg(title,content,onconfirm,oncancel,hide_button){let _dialog=document.createElement("div");_dialog.classList.add("dialog");let confirm="function"==typeof onconfirm?randomFunName():"pass",cancel="function"==typeof oncancel?randomFunName():"pass";if("pass"!=confirm&&(window[confirm]=onconfirm),"pass"!=cancel&&(window[cancel]=oncancel),_dialog.innerHTML=`<div class="dialog"><div class="title">${title}</div><div class="content">${content}</div><div class="buttons"><button data="" class="confirm circle-button" onclick="window.${confirm}()" title="确定">确定</button><button data="" class="cancel circle-button" onclick="window.${cancel}()" title="取消">取消</button></div></div>`,hide_button)try{_dialog.querySelector("."+hide_button).style.display="none"}catch{}return document.body.appendChild(_dialog),_dialog}function touch_e(e){let view=document.querySelector(".view"),app=document.querySelector(".app");if(view.classList.remove("leftest"),view.classList.remove("rightest"),view.classList.remove("topest"),view.classList.remove("bottomest"),vertical=Math.abs(e.changedTouches[0].clientX-window.startLocation.clientX)<Math.abs(e.changedTouches[0].clientY-window.startLocation.clientY),window.direction||(window.direction=vertical?"vertical":"horizontal"),"vertical"==window.direction){window.direction=window.direction?window.direction:"vertical";let mv=(e.changedTouches[0].clientY-window.startLocation.clientY)/screen.height*100,fst_pg=document.querySelector(".app>.page:nth-child(1)");mv>0&1*app.getAttribute("showat")==1?view.classList.add("topest"):mv<0&1*app.getAttribute("showat")==document.querySelectorAll(".app>.page").length?view.classList.add("bottomest"):fst_pg.style.marginTop=mv+"%"}else{let page_ctr=document.querySelector(".app>.page:nth-child("+app.getAttribute("showat")+")>.page-container");if(!page_ctr)return;let mv=(e.changedTouches[0].clientX-window.startLocation.clientX)/screen.width*100,fst_it=page_ctr.children[0];mv>0&1*page_ctr.getAttribute("showat")==1?view.classList.add("leftest"):mv<0&1*page_ctr.getAttribute("showat")==page_ctr.children.length?view.classList.add("rightest"):fst_it.style.marginLeft=mv+"%"}}function nav_page(){let app=document.querySelector(".app"),view=document.querySelector(".view");if(view.classList.remove("leftest"),view.classList.remove("rightest"),view.classList.remove("topest"),view.classList.remove("bottomest"),"vertical"==window.direction){window.direction=null;let fst_pg=document.querySelector(".app>.page:nth-child(1)"),mar=1*fst_pg.style.marginTop.match(/\-?\d+\.\d+/);Math.abs(mar)>25?(fst_pg.style.marginTop=100*mar/Math.abs(mar)+"%",fst_pg.style.transition=".5s",setTimeout((app,mar,fst_pg)=>{let cur_page=1*app.getAttribute("showat")-mar/Math.abs(mar);app.setAttribute("showat",cur_page),app.style.transform="translateY("+-100*(cur_page-1)+"%)",fst_pg.style.marginTop="",fst_pg.style.transition=""},500,app,mar,fst_pg)):(fst_pg.style.marginTop="",fst_pg.style.transition=".5s",setTimeout(fst_pg=>{fst_pg.style.transition=""},500,fst_pg))}else{window.direction=null;let page_ctr=document.querySelector(".app>.page:nth-child("+app.getAttribute("showat")+")>.page-container");if(!page_ctr)return;let fst_it=page_ctr.children[0],mar=1*fst_it.style.marginLeft.match(/\-?\d+\.\d+/);Math.abs(mar)>25?(fst_it.style.marginLeft=100*mar/Math.abs(mar)+"%",fst_it.style.transition=".5s",setTimeout((page_ctr,mar,fst_it)=>{let cur_it=1*page_ctr.getAttribute("showat")-mar/Math.abs(mar);page_ctr.setAttribute("showat",cur_it),page_ctr.style.transform="translateX("+-100*(cur_it-1)+"%)",fst_it.style.marginLeft="",fst_it.style.transition=""},500,page_ctr,mar,fst_it)):(fst_it.style.marginLeft="",fst_it.style.transition=".5s",setTimeout(fst_it=>{fst_it.style.transition=""},500,fst_it))}}window.pass=function pass(){},window.addEventListener("touchmove",touch_e),window.addEventListener("touchstart",save_start_location),window.addEventListener("touchend",nav_page),ws.send("login",getCookie("DevicesUUID")),document.addEventListener("click",e=>{e.target==document.querySelector(".logout")&&alertDialg("退出登录","",()=>{ws.emit("recall_device",getCookie("DeviceUUID"))});let inc=!1,unclaim_exam_page=document.querySelectorAll(".claim-exam");unclaim_exam_page.forEach(i=>{inc=e.target==i||inc}),inc&&alertDialg("认领考试","确定认领该场考试吗",()=>{let exam_info=JSON.parse(e.target.getAttribute("data"));ws.emit("claim_exam",{DeviceUUID:getCookie("DeviceUUID"),examGuid:exam_info.examGuid,studentCode:exam_info.studentCode})}),inc=!1;let dialog_buttons=document.querySelectorAll(".buttons>.circle-button");unclaim_exam_page.forEach(i=>{inc=e.target==i||inc}),inc&&e.target.cloest("dialog").remove()}),ws.on("logout",data=>{200!=data.status&&alert(data.message),location.assign("/auth")}),ws.on("claim_success",data=>{location.reload()});